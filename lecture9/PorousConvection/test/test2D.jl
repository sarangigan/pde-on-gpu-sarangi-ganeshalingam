using PorousConvection
using Test

include("../scripts/porous_convection_xpu.jl")

# test scale
nx = 50
ny = 50
nt = 10

T = porous_convection_2D(nx = nx, ny = ny, nt = nt)

# a unit test
@testset "PorousConvection.jl" begin
    # Write your tests here.
    B = [2,4,6,8,10]
    @test av1(B) ≈ [3,5,7,9]
end

# a reference test:

xinds = [5, 9, 12, 13, 22, 35, 37, 42, 43, 49]
yinds = [8, 11, 14, 19, 20, 23, 24, 40, 45, 47]

ref_T = [0.0039970363447153195 1.1868363863635556e-5 2.453627082970646e-8 4.991924276054518e-13 5.4555605672440654e-14 6.581825735211362e-17 6.833282509553806e-18 -1.403723700744462e-5 -0.149085962466249 -3.4808853395223043; 0.003984643188182906 1.1805271379103852e-5 2.4333882832384333e-8 4.917789470145559e-13 5.366117557873553e-14 7.030336661468638e-17 1.575083564398507e-17 -1.4818125503875883e-5 -0.15121705948293412 -3.5001643466495707; 0.003976406549941469 1.1758018148393876e-5 2.4162580396892287e-8 4.930029511436541e-13 7.283743794709973e-14 1.2592795034649202e-13 1.9396238990689089e-13 -1.5686324432719807e-5 -0.15334097378934736 -3.5190546560502316; 0.003975887180284657 1.1751265949305015e-5 2.4125250949401243e-8 6.961396798966893e-13 5.575744654130089e-13 3.2664020853542603e-12 5.033099358568434e-12 -1.597082067529295e-5 -0.15393151338371241 -3.524176529412281; 0.004902045513313102 1.7787473132148624e-5 7.867738394791923e-6 0.012781092751972383 0.04120289774452612 0.49927767236297027 0.7968245102028554 1.7989508982087799e-6 -0.13865211133939429 -3.365992440049499; 0.003992218736233972 1.1811897087258832e-5 2.4230483989302554e-8 2.3144061970590273e-9 5.891474933644248e-9 4.3024195445244114e-8 6.628411643411767e-8 -1.6213140407781693e-5 -0.1535802166056038 -3.5199331824509548; 0.003977651562071233 1.1754473689798515e-5 2.4112923042590647e-8 5.504851682608311e-12 1.2178381839822345e-11 8.127889722899135e-11 1.252264557149834e-10 -1.6198298535835507e-5 -0.15429463249074984 -3.5271783339325786; 0.003984643188182906 1.1805271379103854e-5 2.4333882832384333e-8 4.917789470145559e-13 5.366117557873553e-14 7.030336661468638e-17 1.575083564398504e-17 -1.4818125503875883e-5 -0.15121705948293412 -3.5001643466495715; 0.0039880775400842955 1.1823135001557519e-5 2.4392554821347675e-8 4.940083068633866e-13 5.39312247095301e-14 6.50410488099686e-17 7.029314075480921e-18 -1.457442592611777e-5 -0.15056985121909994 -3.494336054743051; 0.004001904854422899 1.189240706141881e-5 2.4610797089699376e-8 5.017726623225695e-13 5.486406804102804e-14 6.629210573898125e-17 6.887857213527589e-18 -1.3783639664171676e-5 -0.14835490875914184 -3.4741478293502475]

@test all(ref_T  .≈ T[xinds, yinds])
